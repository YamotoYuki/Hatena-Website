
  <!DOCTYPE html>
  <html lang="ja">
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <link rel="icon" type="image/png" href="/images/icon.jpg">
      <title>投稿ページ</title>
      <link rel="stylesheet" href="css/toukou.css">
  </head>
  <body>
  
      <header>
          <h1>ニュース投稿</h1>
      </header>
  
      <section class="upload-section">
          <form id="newsForm" enctype="multipart/form-data">
              <label>タイトル:</label>
              <input type="text" id="title" name="title" required>
  
              <label>内容:</label>
              <textarea id="content" name="content" required></textarea>
  
              <label>画像:</label>
              <input type="file" id="image" name="image" accept="image/*" required>
              <img id="preview" src="#" alt="プレビュー" style="display:none; width:100px;">
  
              <button type="submit">投稿する</button>
          </form>
      </section>
  </body>

  <script>
    document.getElementById('newsForm').addEventListener('submit', function(event) {
        event.preventDefault();

        const title = document.getElementById('title').value;
        const content = document.getElementById('content').value;
        const image = document.getElementById('image').files[0];

        if (!title || !content || !image) {
            alert('すべての項目を入力してください');
            return;
        }

        const reader = new FileReader();
        reader.onload = function(e) {
            const newsData = {
                title: title,
                content: content,
                image: e.target.result,  // Base64で保存
                date: new Date().toLocaleString()
            };

            let newsList = JSON.parse(localStorage.getItem('news')) || [];
            newsList.push(newsData);
            localStorage.setItem('news', JSON.stringify(newsList));

            alert('投稿が完了しました！');
            window.location.href = "news.html"; // 投稿後にニュースページへ
        };
        reader.readAsDataURL(image);
    });
</script>

<script>
    async function uploadToGitHub(file) {
        const GITHUB_USERNAME = "あなたのGitHubユーザー名";
        const REPO_NAME = "リポジトリ名";
        const TOKEN = "GitHubのPersonal Access Token";  // **安全な方法で管理！**
        const FILE_NAME = `uploads/${Date.now()}_${file.name}`;
        
        const reader = new FileReader();
        reader.readAsDataURL(file);
        
        return new Promise((resolve, reject) => {
            reader.onload = async function() {
                const base64Data = reader.result.split(',')[1];  // `data:image/png;base64,xxx` を削除
                
                const response = await fetch(`https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${FILE_NAME}`, {
                    method: "PUT",
                    headers: {
                        "Authorization": `token ${TOKEN}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        message: "Upload image",
                        content: base64Data
                    })
                });

                const result = await response.json();
                resolve(result.content.download_url);
            };
        });
    }

    document.getElementById('newsForm').addEventListener('submit', async function(event) {
        event.preventDefault();

        const title = document.getElementById('title').value;
        const content = document.getElementById('content').value;
        const imageFile = document.getElementById('image').files[0];

        if (!title || !content || !imageFile) {
            alert('すべての項目を入力してください');
            return;
        }

        const imageUrl = await uploadToGitHub(imageFile);

        const newsData = {
            title: title,
            content: content,
            image: imageUrl,  // GitHubにアップロードされたURL
            date: new Date().toLocaleString()
        };

        let newsList = JSON.parse(localStorage.getItem('news')) || [];
        newsList.push(newsData);
        localStorage.setItem('news', JSON.stringify(newsList));

        alert('投稿が完了しました！');
        window.location.href = "news.html"; // 投稿後にニュースページへ
    });
</script>
  </html>
  
  

